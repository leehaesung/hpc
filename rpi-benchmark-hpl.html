<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="generator" content="pandoc">
    <title>Software Carpentry: $100 달러 오픈 슈퍼 컴퓨터</title>
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" type="text/css" href="css/bootstrap/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="css/bootstrap/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="css/swc.css" />
    <link rel="alternate" type="application/rss+xml" title="Software Carpentry Blog" href="http://software-carpentry.org/feed.xml"/>
    <meta charset="UTF-8" />
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    
      ga('create', 'UA-59802572-15', 'auto');
      ga('send', 'pageview');
    
    </script>
  </head>
  <body class="lesson">
    <div class="container card">
      <div class="banner">
        <a href="http://xwmooc.net" title="xwMOOC">
          <img alt="xwMOOC banner" src="img/xwMOOC.png" />
        </a>
      </div>
      <article>
      <div class="row">
        <div class="col-md-10 col-md-offset-1">
          <h1 class="title">$100 달러 오픈 슈퍼 컴퓨터</h1>
          <h2 class="subtitle">성능시험2 - HPL을 통한 객관적 성능</h2>
<h3 id="고성능-린팩hpl-이란">고성능 린팩(HPL) 이란?</h3>
<ul>
<li><a href="http://www.netlib.org/benchmark/hpl/">HPL (High Performance Linpack)</a> 은 전세계 HPC (High Performance Computer) 성능을 측정하기 위해 고안된 Linpack 이다.</li>
<li>HPL을 통해 임의 작업을 부여해줌으로써 병렬컴퓨터의 성능을 객관적인 수치로 출력할 수 있다.</li>
</ul>
<h3 id="hpl-설치방법">HPL 설치방법</h3>
<ul>
<li>선수 프로그램 : gfortran, MPICH2, mpich2-dev, BLAS</li>
<li>이중 MPICH2 와 gfortran 은 라즈베리파이 클러스터링 작업에서 설치완료된 상태 (<a href="rpi-manual.html">제작 메뉴얼</a> 참조).</li>
</ul>
<h4 id="mpich2-파일-복사">1. MPICH2 파일 복사</h4>
<p>앞서 제작한 클러스터 라즈베리파이에 설치된 MPICH2 파일을 손상하지 않기 위해 MPICH2 파일을 다른 디렉토리로 복사한다.</p>
<ul>
<li>라즈베리파이의 /usr/local/ 에 새로운 디렉토리를 만든다.
<ul>
<li><code>$ mkdir mpich2</code></li>
</ul></li>
<li><code>/home/pi/mpich2/mpich-3.1/</code> 의 모든파일을 위 디렉토리 <code>/usr/local/mpich2/</code> 로 복사해온다. <code>/home/pi/mpich2/mpich-3.1</code> 에서 다음 명령어를 실행한다.
<ul>
<li><code>$ sudo cp -rf * /usr/local/mpich2</code></li>
</ul></li>
</ul>
<h4 id="나머지-선수-프로그램-설치">2. 나머지 선수 프로그램 설치</h4>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python">$ sudo apt<span class="op">-</span>get install libatlas<span class="op">-</span>base<span class="op">-</span>dev libmpich2<span class="op">-</span>dev gfortran</code></pre></div>
<h4 id="hpl-프로그램-다운로드">3. HPL 프로그램 다운로드</h4>
<ul>
<li>다운로드할 위치는 /home/pi/ 디렉토리로 한다.
<ul>
<li><code>$ sudo wget http://www.netlib.org/benchmark/hpl/hpl-2.1.tar.gz</code></li>
</ul></li>
<li>hpl 프로그램을 압축해제한다.
<ul>
<li><code>$ tar xf hpl-2.1.tar.gz</code></li>
</ul></li>
<li><code>hpl-2.1/setup/</code> 디렉토리의 <code>make_generic</code> 쉘을 불러낸다.
<ul>
<li><code>$ cd hpl-2.1/setup</code></li>
<li><code>$ sh make_generic</code></li>
</ul></li>
<li><code>hpl-2.1/</code> 디렉토리에 <code>Make.UNKOWN</code> 파일을 <code>Make.rpi</code> 파일로 복사한다.
<ul>
<li><code>$ cd ..</code></li>
<li><code>$cp setup/Make.UNKNOWN Make.rpi</code></li>
</ul></li>
</ul>
<h4 id="make-파일내용-수정하기">4. Make 파일내용 수정하기</h4>
<ul>
<li><code>Make.rpi</code> 파일을 수행하기에 앞서, 해당 파일을 개인의 라즈베리파이 설정에 맞게 수정한다.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python">ARCH <span class="op">=</span> rpi 
TOPdir <span class="op">=</span> <span class="op">/</span>home<span class="op">/</span>pi<span class="op">/</span>hpl<span class="fl">-2.1</span> 
MPdic <span class="op">=</span> <span class="op">/</span>usr<span class="op">/</span>local<span class="op">/</span>mpich2
MPinc <span class="op">=</span> <span class="op">-</span>I $(MPdir)<span class="op">/</span>include
MPlib <span class="op">=</span> <span class="op">/</span>home<span class="op">/</span>pi<span class="op">/</span>mpi<span class="op">-</span>build<span class="op">/</span>lib<span class="op">/</span>.lib<span class="op">/</span>libmpich.a
LAdir <span class="op">=</span> <span class="op">/</span>usr<span class="op">/</span>lib<span class="op">/</span>atlas<span class="op">-</span>base<span class="op">/</span>
LAlib <span class="op">=</span> $(LAdir)<span class="op">/</span>libf77blas.a $(LAdir)<span class="op">/</span>libatlas.a</code></pre></div>
<ul>
<li>TOPdir 은 hpl-2.1 디렉토리가 있는 경로로 설정한다.</li>
<li>MPdir 은 mpich2 가 있는 디렉토리 경로로 설정한다.</li>
<li>MPlib 은 libmpich.a 파일이 있는 경로로 한다.</li>
<li>만약 libmpich.a 파일의 경로를 모를 경우 :
<ul>
<li><code>$ sudo find / -name &quot;libmpich.a&quot;</code> 로 찾는다.</li>
</ul></li>
<li>LAdir 은 atlas-base 디렉토리가 있는 경로로 설정한다.</li>
</ul>
<h4 id="make-파일을-실행한다.">5. Make 파일을 실행한다.</h4>
<ul>
<li><code>$ make arch=rpi</code></li>
<li>여기까지 정상적으로 진행되면, <code>/home/pi/hpl-2.1/bin/rpi/</code> 디렉토리에 <code>HPL.dat</code> 파일과 <code>xhpl</code> 파일이 생긴다. <code>$cd bin/rpi</code> : 해당 디렉토리로 이동한다.</li>
</ul>
<h3 id="hpl-실행하기-단일-노드">HPL 실행하기 (단일 노드)</h3>
<ul>
<li>HPL.dat 파일을 아래와 같이 수정하고 저장하고 빠져나온다.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python">$ sudo nano HPL.dat </code></pre></div>
<p><img src="fig/rpi-HPLmakefileEdit.png" alt="HPL 단일노드 HPL.dat 설정" width="50%" /></p>
<pre class="output"><code>HPLinpack benchmark input file
Innovative Computing Laboratory, University of Tennessee 
HPL.out output file name (if any)
6 device out (6=stdout,7=stderr,file)
1 # of problems sizes (N)
5040 Ns
1 # of NBs
128 NBs
0 PMAP process mapping (0=Row-,1=Column-major)
1 # of process grids (P x Q)
1 Ps
1 Qs
16.0 threshold
1 # of panel fact
2 PFACTs (0=left, 1=Crout, 2=Right)
1 # of recursive stopping criterium
4 NBMINs (&gt;= 1)
1 # of panels in recursion
2 NDIVs
1 # of recursive panel fact.
1 RFACTs (0=left, 1=Crout, 2=Right)
1 # of broadcast
1 BCASTs (0=1rg,1=1rM,2=2rg,3=2rM,4=Lng,5=LnM)
1 # of lookahead depth
1 DEPTHs (&gt;=0)
2 SWAP (0=bin-exch,1=long,2=mix)
64 swapping threshold
0 L1 in (0=transposed,1=no-transposed) form
0 U in (0=transposed,1=no-transposed) form
1 Equilibration (0=no,1=yes)
8 memory alignment in double (&gt; 0)</code></pre>
<ul>
<li><code>xhpl</code> 파일을 실행한다.</li>
</ul>
<pre class="shell"><code>$./xhpl</code></pre>
<ul>
<li>결과를 기다린다. 성공적으로 진행되면 아래와 같은 과정을 출력한다.</li>
</ul>
<p><img src="fig/rpi-HPLonSingleResult1-1.png" alt="HPL 단일노드 HPL.dat 설정" width="50%" /></p>
<ul>
<li>기다리면 아래와 같은 결과를 출력한다. (컴퓨터 환경에 따라 소요시간이 다를 수 있다.) 여기서 Time은 작업을 수행하는데 걸린시간(sec)이고, Gflops는 작업수행 속도이다. (위 사진은 대략 540.68초의 시간이 소요되었고, 1.579e-01 의 속도를 보였다.)</li>
</ul>
<p><img src="fig/rpi-HPLonSingleResult1-2.png" alt="HPL 단일노드 HPL.dat 설정" width="50%" /></p>
<h3 id="hpl-실행하기-노드-다수">HPL 실행하기 (노드 다수)</h3>
<ul>
<li><p>먼저 수행할 모든 라즈베리파이에 위의 과정에 따라 HPL 프로그램을 설치한다.</p></li>
<li><code>HPL.dat</code> 파일의 ‘Ps * Qs’ 값 수정
<ul>
<li>작업에 사용할 node의 갯수를 정하기 위해 <code>Ps * Qs</code>값만 수정하면 된다.</li>
<li>허브서버로 동작할 라즈베리파이(pi01)의 <code>/home/pi/hpl-2.1/bin/rpi</code> 에서 <code>nano</code> 편집기로 <code>Ps</code>, <code>Qs</code> 값을 편집한다.</li>
<li>예를 들어 4개의 라즈베리파이를 이용한 HPL 작업을 수행하려면 위와 같이 <code>Ps * Qs</code> 의 값이 4가 되게 지정해 주면 된다.</li>
<li>저장하고 빠져나온다.</li>
</ul></li>
</ul>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python">$sudo nano HPL.dat</code></pre></div>
<pre class="output"><code>1 # of process grids (P x Q)
1 Ps
4 Qs</code></pre>
<ul>
<li><code>xhpl</code> 파일을 실행한다.
<ul>
<li><code>/home/pi/hpl-2.1/bin/rpi</code> 에서 <code>machinefile</code> 파일을 MPI로 동작시키기</li>
<li><code>machinefile</code> 은 라즈베리파이 클러스터의 MPI 테스트를 위해 만들어두었던 연결된 모든 라즈베리파이의 ip가 기록된 파일이다.</li>
</ul></li>
</ul>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python">$ mpiexec <span class="op">-</span>f <span class="op">~/</span>machinefile <span class="op">-</span>n <span class="dv">4</span> .<span class="op">/</span>xhpl</code></pre></div>
<p><img src="fig/rpi-HPLonMultiResult4-1.png" alt="HPL 단일노드 HPL.dat 설정" width="50%" /></p>
<ul>
<li>결과를 기다린다. 성공적으로 진행되면 아래와 같은 과정을 출력한다. 기다리면 아래와 같은 결과를 출력한다. (컴퓨터 환경에 따라 소요시간이 다를 수 있다.) 여기서 Time 은 작업을 수행하는데 걸린시간(sec)이고, Gflops는 작업수행 속도이다. (위 사진은 대략 157.77초의 시간이 소요되었고, 5.412e-01 의 속도를 보였다.)</li>
</ul>
<p><img src="fig/rpi-HPLonMultiResult4-2.png" alt="HPL 단일노드 HPL.dat 설정" width="50%" /></p>
<h3 id="hpl.dat-파일-코드-분석">HPL.dat 파일 코드 분석</h3>
<h4 id="기본-정보-설정">기본 정보 설정</h4>
<ul>
<li>HPLinpack benchmark input file
<ul>
<li>//input 파일의 제목에 해당한다.</li>
</ul></li>
<li>Innovative Computing Laboratory, University of Tennessee
<ul>
<li>//해당 input 파일의 출처를 밝힌다.</li>
</ul></li>
<li>HPL.out output file name (if any)
<ul>
<li>//해당 output 파일의 제목을 지정해준다.</li>
</ul></li>
<li>6 device out (6=stdout,7=stderr,file)
<ul>
<li>//해당 output 파일이 놓일 위치를 지칭한다.</li>
<li>//3가지 경우가 존재하며, 6:standard output, 7:standard error, 다른 양의 정수: redirect to a file 을 지칭한다.</li>
</ul></li>
</ul>
<aside class="callout panel panel-info">
<div class="panel-heading">
<h4 id="hpl-컴퓨팅-정보-설정"><span class="glyphicon glyphicon-pushpin"></span>HPL 컴퓨팅 정보 설정</h4>
</div>
<div class="panel-body">
<ul>
<li>1 # of problems sizes (N)
<ul>
<li>//수행할 작업의 갯수를 지칭한다: 1~20 까지 가능하다.</li>
</ul></li>
<li>5040 Ns
<ul>
<li>//수행할 각각의 작업의 사이즈를 지칭한다. (따라서 윗줄의 problems sizes 갯수 만큼 숫자가 필요하다.)</li>
</ul></li>
<li>1 # of NBs
<ul>
<li>//수행할 블록의 갯수를 지칭한다: 1~20 까지 가능하다.</li>
</ul></li>
<li>128 NBs
<ul>
<li>//수행할 각각의 블록의 사이즈를 지칭한다. (따라서 윗줄의 NBs 갯수 만큼 숫자가 필요하다.)</li>
</ul></li>
<li>0 PMAP process mapping (0=Row-,1=Column-major)
<ul>
<li>//MPI 병렬작업이 mapping되는 방법을 지칭하며, 0: 행으로, 1: 열로 mapping 하는 방법이다. (0이 추천된다.)</li>
</ul></li>
<li>2 # of process grids (P x Q)
<ul>
<li>//수행될 process grids 의 갯수를 지칭한다: 1~20까지 가능하다.</li>
</ul></li>
<li>2 7 Ps</li>
<li>3 4 Qs
<ul>
<li>//위 process grid 가 작업수행시 사용할 각각의 노드 수를 지정한다. 위의 예로 볼때, process gird는 2개, &gt; 각각 P * Q=(2X3=6), (7X4=28)이다. 예를 들어 30개의 노드가 있는 슈퍼컴퓨터라면 process grid에 첫번째 작업을 &gt; 수행할 때는 6개의 노드만 사용하고 두번째 작업에선 28개의 노드를 사용한다는 의미다.</li>
</ul></li>
</ul>
</div>
</aside>
<h3 id="hpl-테스트-결과">HPL 테스트 결과</h3>
<p>결과의 정확한 비교를 위해 ‘Ps * Qs’ 값을 제외한 모든 내용은 변화시키지 않는다.</p>
<h4 id="hpl-동작에-한-개의-라즈베리파이만-사용.">HPL 동작에 한 개의 라즈베리파이만 사용.</h4>
<p>HPL.dat 파일의 <code>Ps * Qs</code> 를 1로 설정한다.</p>
<p><img src="fig/rpi-HPLonSingleResult1-2.png" alt="HPL 단일노드 HPL.dat 설정" width="50%" /></p>
<p>여기서 Time 은 작업을 수행하는데 걸린시간(sec)이고, Gflops는 작업수행 속도이다. (위 사진은 대략 540.68초의 시간이 소요되었고, 1.579e-01 의 속도를 보였다.)</p>
<h4 id="hpl-동작에-두-개의-라즈베리파이를-사용.">HPL 동작에 두 개의 라즈베리파이를 사용.</h4>
<p>HPL.dat 파일의 <code>Ps * Qs</code> 를 2로 설정한다.</p>
<p><img src="fig/rpi-HPLonMultiResult2-2.png" alt="HPL 단일노드 HPL.dat 설정" width="50%" /></p>
<p>여기서 Time 은 작업을 수행하는데 걸린시간(sec)이고, Gflops는 작업수행 속도이다. (위 사진은 대략 287.55초의 시간이 소요되었고, 2.970e-01 의 속도를 보였다.)</p>
<h4 id="hpl-동작에-세-개의-라즈베리파이를-사용.">HPL 동작에 세 개의 라즈베리파이를 사용.</h4>
<p>HPL.dat 파일의 <code>Ps * Qs</code> 를 3으로 설정한다.</p>
<p><img src="fig/rpi-HPLonMultiResult3-2.png" alt="HPL 단일노드 HPL.dat 설정" width="50%" /></p>
<p>여기서 Time 은 작업을 수행하는데 걸린시간(sec)이고, Gflops는 작업수행 속도이다. (위 사진은 대략 200.87초의 시간이 소요되었고, 4.251e-01 의 속도를 보였다.)</p>
<h4 id="hpl-동작에-네-개의-라즈베리파이를-사용.">HPL 동작에 네 개의 라즈베리파이를 사용.</h4>
<p>HPL.dat 파일의 <code>Ps * Qs</code> 를 4로 설정한다.</p>
<p><img src="fig/rpi-HPLonMultiResult4-2.png" alt="HPL 단일노드 HPL.dat 설정" width="50%" /></p>
<p>여기서 Time 은 작업을 수행하는데 걸린시간(sec)이고, Gflops는 작업수행 속도이다. (위 사진은 대략 157.77초의 시간이 소요되었고, 5.412e-01 의 속도를 보였다.)</p>
<h3 id="hpl-테스트-결과-분석">HPL 테스트 결과 분석</h3>
<h4 id="단일노드에서-hpl-작업-비교">단일노드에서 HPL 작업 비교</h4>
<ul>
<li>각각의 라즈베리파이 HPL 작업 시간(sec)</li>
</ul>
<p><img src="fig/rpi-HPLsingle_Tchart.png" alt="HPL 단일노드 HPL.dat 설정" width="50%" /></p>
<ul>
<li>각각의 라즈베리파이 HPL 작업 속도(Gflops)</li>
</ul>
<p><img src="fig/rpi-HPLsingle_Vchart.png" alt="HPL 단일노드 HPL.dat 설정" width="50%" /></p>
<h4 id="멀티노드에서-hpl-작업-비교">멀티노드에서 HPL 작업 비교</h4>
<ul>
<li>라즈베리파이 갯수에 따른 HPL 작업 시간(sec)</li>
</ul>
<p><img src="fig/rpi-HPLmulti_Tchart.png" alt="HPL 단일노드 HPL.dat 설정" width="50%" /></p>
<ul>
<li>라즈베리파이 갯수에 따른 HPL 작업 속도(Gflops)</li>
</ul>
<p><img src="fig/rpi-HPLmulti_Vchart.png" alt="HPL 단일노드 HPL.dat 설정" width="50%" /></p>
<ul>
<li>라즈베리파이 갯수에 따른 HPL 작업 속도(배)</li>
</ul>
<p><img src="fig/rpi-HPLmulti_Vchart2.png" alt="HPL 단일노드 HPL.dat 설정" width="50%" /></p>
        </div>
      </div>
      </article>
      <div class="footer">
        <a class="label swc-blue-bg" href="http://xwmooc.net">xwMOOC</a>
        <a class="label swc-blue-bg" href="https://github.com/statkclee/hpc">Source</a>
        <a class="label swc-blue-bg" href="mailto:i@xwmooc.net">Contact</a>
        <a class="label swc-blue-bg" href="LICENSE.html">License</a>
      </div>
    </div>
    <!-- Javascript placed at the end of the document so the pages load faster -->
    <script src="http://software-carpentry.org/v5/js/jquery-1.9.1.min.js"></script>
    <script src="css/bootstrap/bootstrap-js/bootstrap.js"></script>
  </body>
</html>
